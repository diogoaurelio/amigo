[Unit]
Description=Teamcity Agent
Requires=network.target
After=network.target

[Service]
ExecStart=/bin/bash -c "source /opt/teamcity/.nvm/nvm.sh && /opt/teamcity/buildAgent/bin/agent.sh start"
ExecStop=/opt/teamcity/buildAgent/bin/agent.sh stop
ExecStartPre=aws s3 sync s3://teamcity-ivy-cache/ /opt/teamcity/.ivy2/cache/
ExecStartPre=aws s3 sync s3://teamcity-ivy-cache/ /opt/teamcity/buildAgent/system/sbt_ivy/cache/
ExecStartPre=aws s3 sync s3://teamcity-sbt-cache/ /opt/teamcity/.sbt/
User=teamcity
WorkingDirectory=/opt/teamcity
Type=forking
PIDFile=/opt/teamcity/buildAgent/logs/buildAgent.pid
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
